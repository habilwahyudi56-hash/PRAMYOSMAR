<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kegiatan ‚Äî PRAMYOSMAR</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
  <header class="header">
    <div class="logo-container">
      <div class="logo-glow">
        <svg class="logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <circle cx="50" cy="50" r="40" fill="none" stroke="#00f3ff" stroke-width="2"/>
          <path d="M30,50 L45,35 L45,65 Z" fill="#e040fb"/>
          <path d="M70,50 L55,35 L55,65 Z" fill="#00f3ff"/>
        </svg>
      </div>
      <h1 class="org-title">PRAMYOSMAR</h1>
      <p class="tagline">Pramuka Muda Yogyakarta Mandiri, Solid, dan Berakhlak</p>
    </div>
    <nav class="nav">
      <a href="index.html">Beranda</a>
      <a href="berita.html">Berita</a>
      <a href="kegiatan.html" class="active">Kegiatan</a>
      <a href="materi.html">Materi</a>
      <a href="ujian.html">Ujian</a>
      <a href="struktur.html">Struktur</a>
      <a href="kontak.html">Kontak</a>
    </nav>
  </header>

  <main class="page-content">
    <div class="container">
      <h1 class="page-title glow">üóìÔ∏è Daftar Kegiatan</h1>

      <!-- Admin Upload -->
      <div class="admin-section">
        <button class="admin-btn" id="admin-btn"></button>
        <div class="upload-form glass" id="upload-form">
          <h3>‚ûï Upload Kegiatan Baru</h3>
          
          <div class="form-group">
            <label>Judul Kegiatan</label>
            <input type="text" id="keg-judul" placeholder="Contoh: Drone Mapping Camp">
          </div>
          
          <div class="form-group">
            <label>Tanggal</label>
            <input type="date" id="keg-tgl">
          </div>
          
          <div class="form-group">
            <label>Deskripsi Lengkap</label>
            <textarea id="keg-desc" rows="4" placeholder="Deskripsi detail untuk halaman lengkap..."></textarea>
          </div>
          
          <!-- üñºÔ∏è File Upload (Galeri) -->
          <div class="form-group">
            <label for="keg-foto-input">Upload Foto Kegiatan</label>
            <div class="file-upload-area glass" onclick="document.getElementById('keg-foto-input').click()">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              <span id="keg-foto-label">Pilih file gambar (JPG/PNG)</span>
              <input 
                type="file" 
                id="keg-foto-input" 
                accept="image/jpeg,image/png,image/webp"
                style="display:none"
                onchange="previewImage(this, 'keg-foto-preview', 'keg-foto-label')"
              >
            </div>
            <div id="keg-foto-preview" class="image-preview" style="display:none; margin-top:1rem;">
              <img id="keg-preview-img" src="" alt="Preview" style="max-width:100%; border-radius:8px; box-shadow:0 0 10px rgba(0,243,255,0.3);">
            </div>
          </div>

          <button class="submit-btn" onclick="uploadKegiatan()">Upload Kegiatan</button>
        </div>
      </div>

      <!-- Daftar Kegiatan -->
      <div class="kegiatan-grid" id="kegiatan-list">
        <p class="glow" style="grid-column:1/-1; text-align:center;">Memuat...</p>
      </div>
    </div>
  </main>

  <script src="script.js"></script>
  <script>
    // Render daftar kegiatan
    function renderKegiatanList() {
      const container = document.getElementById('kegiatan-list');
      const kegiatan = JSON.parse(localStorage.getItem('pramyosmar_kegiatan') || '[]');
      
      if (kegiatan.length === 0) {
        container.innerHTML = `<p class="glow" style="grid-column:1/-1; text-align:center;">Belum ada kegiatan.</p>`;
        return;
      }

      container.innerHTML = kegiatan.map(k => `
        <div class="kegiatan-card glass">
          <img 
            src="${k.image || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2250%22 y=%2250%22 font-size=%2212%22 fill=%22%23555%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22>NO IMAGE</text></svg>'}" 
            alt="${k.title}" 
            class="kegiatan-img"
            onclick="openDetail(${k.id})"
          >
          <div class="kegiatan-info">
            <h3 class="kegiatan-title">${k.title}</h3>
            <p class="kegiatan-date">${formatDate(k.tanggal)}</p>
          </div>
        </div>
      `).join('');
    }

    function openDetail(id) {
      localStorage.setItem('pramyosmar_kegiatan_active_id', id);
      window.location.href = 'kegiatan-detail.html';
    }

    async function uploadKegiatan() {
      if (!isAdmin) return alert("üîí Login sebagai admin dulu!");

      const judul = document.getElementById('keg-judul').value.trim();
      const tgl = document.getElementById('keg-tgl').value;
      const desc = document.getElementById('keg-desc').value.trim();
      const fileInput = document.getElementById('keg-foto-input');

      if (!judul || !tgl || !desc) return alert("‚ùå Judul, tanggal, dan deskripsi wajib diisi!");

      let imageData = '';

      if (fileInput.files && fileInput.files[0]) {
        try {
          imageData = await getBase64FromFile(fileInput.files[0]);
        } catch (err) {
          return alert("‚ùå Gagal membaca file gambar.");
        }
      }

      const data = {
        id: Date.now(),
        title: judul,
        tanggal: tgl,
        description: desc,
        image: imageData
      };

      let list = JSON.parse(localStorage.getItem('pramyosmar_kegiatan') || '[]');
      list.unshift(data);
      localStorage.setItem('pramyosmar_kegiatan', JSON.stringify(list));

      alert("‚úÖ Kegiatan berhasil diupload!");
      renderKegiatanList();

      // Reset form
      document.getElementById('keg-judul').value = '';
      document.getElementById('keg-tgl').value = '';
      document.getElementById('keg-desc').value = '';
      fileInput.value = '';
      document.getElementById('keg-foto-preview').style.display = 'none';
      document.getElementById('keg-foto-label').textContent = 'Pilih file gambar (JPG/PNG)';
    }

    function formatDate(dateStr) {
      if (!dateStr) return '‚Äî';
      const d = new Date(dateStr);
      return d.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
    }

    // Inisialisasi
    document.addEventListener('DOMContentLoaded', () => {
      renderKegiatanList();
      updateAdminUI();
    });
  </script>
</body>
</html>
